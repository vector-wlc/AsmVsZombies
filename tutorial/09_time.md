# 时间体系

AvZ 中的时间用 (波次, 帧数) 的二元组表示，一帧对应游戏中的 0.01s，圈内也通常称为 1cs。**帧数可以超过本波波长，也可以为负数。**

对于生存无尽，可用的波次范围为 0~21。其中第 0 波的基准时间为本次选卡开始（即 `PLANT!` 字样消失的时刻），第 1~20 波的基准时间为对应波僵尸生成，第 21 波的基准时间为本次选卡结束（即 `More zombies approaching!` 字样消失的时刻）。
AvZ 中最早可操作的时间为 (0, 1), 最晚可操作的时间为 (21, -1)。

在游戏中，每一波的持续时长如下：

- 0 波：固定 600
- 1~8 波：每波 601~3100
- 9 波：1346~5245
- 10~18 波：每波 601~3100
- 19 波：1346~5245
- 20 波：500~5999

在第 1~8, 11~18 波，本波僵尸总血量低于某个阈值后 200cs 会刷新下一波僵尸。这个检测最早在本波僵尸生成后 401cs 进行，因此波长至少为 601cs。此后每帧检测一次，直到波长达到一个上限（在 2500~3100 之间随机）后强制刷新下一波。

在第 9, 19 波，本波除伴舞和魅惑僵尸以外的僵尸全部死亡后 945cs 会刷新下一波僵尸。这个检测最早在本波僵尸生成后 401cs 进行，因此波长至少为 1346cs。此后每帧检测一次，波长上限为 5245cs。

在第 20 波，全场所有僵尸死亡后 499cs 会结束本轮选卡，5500cs 时强制触发结束选卡。结束选卡的标志为 `More zombies approaching!` 字样出现，这期间仍可操作。

AvZ 会自动读取内存数据以尽早确定每一波的基准时间。在不人为设置的情况下，每一波**确定基准时间的时刻**相对于该波的实际基准时间的偏移为：

- 0 波：1
- 1 波：-599
- 2~9 波：-200
- 10 波：-945
- 11~19 波：-200
- 20 波：-945
- 21 波：-499

这意味着如果你将某个操作的时间设为 (2, -300)，那么这个操作无法正常执行，因为在 (2, -300) 时，AvZ 还未确定第 2 波的基准时间。

可以通过 `AAssumeWavelength`、`ASetWavelength` 以及 DSL 中的 `Trig`、`TrigAt` 等函数人为假定某些波的波长，从而可以使用更小的负数偏移。
例如，在调用 `AAssumeWavelength({{1, 601}, {2, 1200}})` 后，(3, -2000) 就变成了合法时间，对应 (0, 401)。

可以通过 `ANowWave` 函数获取当前波。这个函数有两种行为：`ANowWave(false)` 返回当前的实际波次，`ANowWave(true)` 返回当前已确定基准时间的波次。
当前者返回 n 时，后者返回的值为 n 或 n+1。例如，若第 1 波波长为 601，则在 (1, 300) 时 `ANowWave(false) = ANowWave(true) = 1`，在 (1, 500) 时 `ANowWave(false) = 1, ANowWave(true) = 2`。

可以通过 `ANowTime` 函数获取当前时间相对于某波的偏移量。例如，若第 1 波波长为 601，且未提前假定波长，则在 (1, 300) 时 `ANowTime(2) = INT_MIN`（当前尚未确定第 1 波波长），在 (1, 500) 时 `ANowTime(2) = -101`。
此外，`ANowTime(true)` 等效于 `ATime(ANowWave(true), ANowTime(ANowWave(true)))`，`ANowTime(false)` 等效于 `ATime(ANowWave(false), ANowTime(ANowWave(false)))`。
